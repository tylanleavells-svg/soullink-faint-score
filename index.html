<script>
const pokemonNames = [
"Bulbasaur","Ivysaur","Venusaur","Charmander","Charmeleon","Charizard",
"Squirtle","Wartortle","Blastoise","Pikachu","Raichu","Eevee",
"Vaporeon","Jolteon","Flareon","Espeon","Umbreon"
];

const players = ["player1","player2","player3","player4"];

function storageKey(id) {
    return "soullink_" + id;
}

function renderDeath(playerId, name) {
    const player = document.getElementById(playerId);
    const deaths = player.querySelector(".deaths");

    const d = document.createElement("div");
    d.className = "death";
    d.innerHTML = `
        <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/items/poke-ball.png">
        ${name}<br>Fainted
    `;
    deaths.appendChild(d);

    player.querySelector(".counter").textContent =
        "Total Losses: " + deaths.children.length;
}

function addDeath(playerId) {
    const input = document.getElementById("select-" + playerId);
    const name = input.value.trim();
    if (!name) {
        alert("Please enter a PokÃ©mon!");
        return;
    }

    const saved = JSON.parse(localStorage.getItem(storageKey(playerId))) || [];
    saved.push(name);
    localStorage.setItem(storageKey(playerId), JSON.stringify(saved));

    renderDeath(playerId, name);
    input.value = "";
}

window.addEventListener("DOMContentLoaded", () => {
    // populate datalist
    const list = document.getElementById("allpokemon");
    pokemonNames.forEach(p => {
        const opt = document.createElement("option");
        opt.value = p;
        list.appendChild(opt);
    });

    // hook up buttons safely
    players.forEach(id => {
        document
            .querySelector(`#${id} button`)
            .addEventListener("click", () => addDeath(id));
    });

    // load saved data
    players.forEach(id => {
        const saved = JSON.parse(localStorage.getItem(storageKey(id))) || [];
        saved.forEach(name => renderDeath(id, name));
    });
});
</script>
